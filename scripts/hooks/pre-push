#!/bin/sh
# Enforce git-flow branch naming convention on push
# Allowed: main, feature/*, fix/*, chore/*, release/*, hotfix/*

branch=$(git symbolic-ref --short HEAD 2>/dev/null)

# Allow main (for merges and tags)
if [ "$branch" = "main" ]; then
  exit 0
fi

# Validate branch name prefix
case "$branch" in
  feature/*|fix/*|chore/*|release/*|hotfix/*)
    exit 0
    ;;
  *)
    echo ""
    echo "ERROR: Branch '$branch' does not follow naming convention."
    echo ""
    echo "Allowed prefixes:"
    echo "  feature/  — new functionality"
    echo "  fix/      — bug fixes"
    echo "  chore/    — maintenance, CI, deps"
    echo "  release/  — version bumps, changelog"
    echo "  hotfix/   — urgent production fixes"
    echo ""
    echo "Rename: git branch -m $branch feature/<descriptive-name>"
    echo ""
    exit 1
    ;;
esac
